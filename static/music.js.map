{
  "version": 3,
  "sources": ["../music.ts"],
  "sourcesContent": ["function el(id: string): HTMLElement { return document.getElementById(id) as any; }\r\n\r\ntype Result = {\r\n    Name: string\r\n    Type: \"Song\" | \"Artist\" | \"Album\" | \"AlbumHeader\" | \"Folder\"\r\n    Link: string, Audio: string,\r\n    Artist: string, Album: string, Image: string,\r\n}\r\n\r\ntype ListMusicResult = {\r\n    Results: Result[], NextPage: string, PrevPage: string\r\n};\r\n\r\nlet audio = document.createElement(\"audio\");\r\nlet nextaudio = document.createElement(\"audio\");\r\nlet is_playing = false, enable_range_update = true, enable_volume_update = true;\r\nlet unmute_volume = audio.volume;\r\naudio.onplay = function () {\r\n    el(\"player-play\").innerHTML = `<i class=\"material-icons\">pause_arrow</i>`;\r\n    is_playing = true;\r\n};\r\naudio.onpause = function () {\r\n    el(\"player-play\").innerHTML = `<i class=\"material-icons\">play_arrow</i>`;\r\n    is_playing = false;\r\n};\r\nfunction formatTime(time: number): string {\r\n    let mins = Math.floor(time / 60).toString();\r\n    let secs = Math.floor(time % 60).toString();\r\n    if (secs.length < 2) {\r\n        secs = \"0\" + secs;\r\n    }\r\n    return mins + \":\" + secs;\r\n}\r\naudio.ontimeupdate = function () {\r\n    if (enable_range_update) {\r\n        el(\"player-curtime\").innerText = formatTime(audio.currentTime);\r\n        (el(\"player-range\") as HTMLInputElement).value = audio.currentTime.toString();\r\n    } else {\r\n        el(\"player-curtime\").innerText = formatTime(parseFloat((el(\"player-range\") as HTMLInputElement).value));\r\n    }\r\n    if (audio.currentTime >= audio.duration) {\r\n        nexttrack();\r\n    }\r\n};\r\naudio.onloadedmetadata = function () {\r\n    el(\"player-endtime\").innerText = formatTime(audio.duration);\r\n    let range = (el(\"player-range\") as HTMLInputElement);\r\n    range.max = audio.duration.toString();\r\n    range.value = \"0\";\r\n    el(\"player-curtime\").innerText = \"0:00\";\r\n};\r\naudio.onvolumechange = function () {\r\n    console.log(audio.volume);\r\n    (el(\"player-volume\") as HTMLInputElement).value = (audio.volume * 100).toString();\r\n    el(\"player-mute\").innerHTML = `<i class=\"material-icons\">${audio.volume > 0 ? 'volume_up' : 'volume_mute'}</i>`;\r\n};\r\n\r\nlet playlist: Result[] = [];\r\nlet playlistIdx = 0;\r\nfunction nexttrack() {\r\n    if (playlistIdx < playlist.length) {\r\n        playlistIdx++;\r\n        playsong();\r\n    }\r\n}\r\nfunction prevtrack() {\r\n    if (playlistIdx > 0) {\r\n        playlistIdx--;\r\n        playsong();\r\n    }\r\n}\r\nfunction playsong() {\r\n    if (playlistIdx < 0 || playlist.length == 0 || playlistIdx >= playlist.length) {\r\n        audio.pause();\r\n        return;\r\n    }\r\n    let song = playlist[playlistIdx];\r\n    console.log(\"play \" + song.Audio);\r\n    audio.src = song.Audio;\r\n    audio.load();\r\n    audio.play();\r\n\r\n    el(\"player-info\").innerHTML = `<a href=\"#artists/${song.Artist}\">${song.Artist}</a><br/><a href=\"#albums/${song.Album}\">${song.Album}</a><br/>${song.Name}`;\r\n    el(\"player-albumcover\").innerHTML = (song.Image as string).length > 0 ? `<img src=\"${song.Image}\">` : ``;\r\n    if ('mediaSession' in navigator) {\r\n        navigator.mediaSession.metadata = new MediaMetadata({\r\n            title: song.Name, artist: song.Artist, album: song.Album, artwork: [{ src: song.Image ?? \"\" }],\r\n        });\r\n        navigator.mediaSession.setActionHandler('play', () => { audio.play(); });\r\n        navigator.mediaSession.setActionHandler('pause', () => { audio.pause(); });\r\n        navigator.mediaSession.setActionHandler('seekto', (details) => { if (details.seekTime) { audio.currentTime = details.seekTime; } });\r\n        navigator.mediaSession.setActionHandler('previoustrack', () => prevtrack());\r\n        navigator.mediaSession.setActionHandler('nexttrack', () => nexttrack());\r\n    }\r\n}\r\n\r\nlet prevApi = \"\";\r\nlet cachedScrolls: Record<string, number> = {};\r\n\r\nfunction getmusic(api: string) {\r\n    if (prevApi.length > 0) {\r\n        cachedScrolls[prevApi] = el(\"results\").scrollTop;\r\n    }\r\n    if (prevApi == \"\" && api == \"\" && window.innerWidth > 750) {\r\n        api = \"albums\";\r\n    }\r\n    var req = new XMLHttpRequest();\r\n    req.open(\"GET\", \"/api/music/\" + api);\r\n    req.onload = function () {\r\n        let res = JSON.parse(req.response) as ListMusicResult;\r\n        let html = \"\";\r\n        if (api == \"albums\") {\r\n            html += `<div class=\"albumcontainer\">`;\r\n            for (let result of res.Results) {\r\n                html += `<div class=\"album\"><a href=\"#${result.Link}\">`;\r\n                if (result.Image.length > 0) {\r\n                    html += `<img class=\"albumbox\" loading=\"lazy\" src=\"/content/${result.Image}\" />`;\r\n                } else {\r\n                    html += `<div class=\"albumbox\"></div>`;\r\n                }\r\n                html += `<div class=\"albumtext\">${result.Name}<br/>${result.Artist}</div></a></div>`;\r\n            }\r\n            html += `</div>`;\r\n        } else {\r\n            let first = true;\r\n            for (let idx in res.Results) {\r\n                let result = res.Results[idx];\r\n                if (result.Type == \"Song\") {\r\n                    html += `<div class=\"song ${first ? 'firstpad' : ''}\">\r\n                        <a class=\"play\" data-idx=\"${idx}\">${result.Name}</a>\r\n                    </div>`;\r\n                } else if (result.Type == \"AlbumHeader\") {\r\n                    html += `<div class=\"albumheader ${first ? '' : 'albumheaderpad'}\"><div>`;\r\n                    if (result.Image.length > 0) {\r\n                        html += `<img class=\"albumbox\" loading=\"lazy\" src=\"/content/${result.Image}\" />`;\r\n                    } else {\r\n                        html += `<div class=\"albumbox\"></div>`;\r\n                    }\r\n                    html += `</div><div><h1>${result.Name}</h1><a href=\"#artists/${result.Artist}\">${result.Artist}</a></div></div>`;\r\n                } else {\r\n                    let icon = \"folder\";\r\n                    if (result.Type == \"Artist\" || result.Name == \"Artists\") {\r\n                        icon = \"person\";\r\n                    } else if (result.Name == \"Albums\") {\r\n                        icon = \"album\";\r\n                    } else if (result.Name == \"Songs\") {\r\n                        icon = \"music_note\";\r\n                    }\r\n                    html += `<div class=\"folder ${first ? 'firstpad' : ''}\"><a href=\"#${result.Link}\"><i class=\"material-icons\">${icon}</i><span>${result.Name}</span></a></div>`;\r\n                }\r\n                first = false;\r\n            }\r\n        }\r\n        el(\"results\").innerHTML = html;\r\n        function nexttrack() { }\r\n        function prevtrack() { }\r\n        for (let node of document.querySelectorAll(\".play\")) {\r\n            let idx = parseInt((node as HTMLElement).dataset.idx as string);\r\n            (node as HTMLElement).onclick = function () {\r\n                playlist = [];\r\n                for (let rx in res.Results) {\r\n                    let ridx = parseInt(rx);\r\n                    if (res.Results[ridx].Type == \"Song\") {\r\n                        if (idx == ridx) {\r\n                            playlistIdx = playlist.length;\r\n                        }\r\n                        playlist.push(res.Results[ridx]);\r\n                    }\r\n                }\r\n                playsong();\r\n            };\r\n        }\r\n        if (cachedScrolls[api]) {\r\n            el(\"results\").scrollTop = cachedScrolls[api];\r\n        }\r\n        prevApi = api;\r\n    };\r\n    req.send();\r\n    el(\"results\").innerHTML = \"\";\r\n}\r\n\r\nwindow.onhashchange = function () {\r\n    getmusic(window.location.hash.slice(1));\r\n};\r\nwindow.onload = function () {\r\n    getmusic(window.location.hash.slice(1));\r\n    el(\"player-play\").onclick = function () {\r\n        if (is_playing) {\r\n            audio.pause();\r\n        } else {\r\n            audio.play();\r\n        }\r\n    };\r\n    el(\"player-range\").onmousedown = function () {\r\n        enable_range_update = false;\r\n    };\r\n    el(\"player-range\").onmouseleave = function () {\r\n        enable_range_update = true;\r\n    };\r\n    el(\"player-range\").oninput = function () {\r\n        enable_range_update = true;\r\n        let time = parseFloat((el(\"player-range\") as HTMLInputElement).value);\r\n        audio.currentTime = time;\r\n    };\r\n    el(\"player-mute\").onclick = function () {\r\n        if (audio.volume == 0) {\r\n            audio.volume = unmute_volume;\r\n        } else {\r\n            unmute_volume = audio.volume;\r\n            audio.volume = 0;\r\n        }\r\n    };\r\n    el(\"player-volume\").onmousedown = function () {\r\n        enable_volume_update = false;\r\n    };\r\n    el(\"player-volume\").onmouseleave = function () {\r\n        enable_volume_update = true;\r\n    };\r\n    el(\"player-volume\").oninput = function () {\r\n        enable_volume_update = true;\r\n        audio.volume = parseFloat((el(\"player-volume\") as HTMLInputElement).value) / 100;\r\n    };\r\n    el(\"player-prev\").onclick = function () {\r\n        prevtrack();\r\n    };\r\n    el(\"player-next\").onclick = function () {\r\n        nexttrack();\r\n    };\r\n};\r\n"],
  "mappings": "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",
  "names": []
}
